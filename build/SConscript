import subprocess

def createConfig(target, source, values):
    outFile = file(str(target), "w")
    inFile = file(str(source), "r")
    outFile.write(inFile.read() % values)
    inFile.close()
    outFile.close()

def generateConfig(target):
	def getCommandOutput(command):
		process = subprocess.Popen("getconf PAGESIZE", shell=True, stdout=subprocess.PIPE)
		return process.stdout.read()

	tf = file(target, "w")
	tf.write("/* This file is automatically generated. Do not edit unless you know what you are doing. */\n\n")
	tf.write("#define AesalonPageSize %s\n" % getCommandOutput("getconf PAGESIZE").strip())
	tf.close()

config = file("config", "r")
buildConfig = eval(config.read())
config.close()

createConfig("../include/common/Config.h", "templates/Config.h.in", buildConfig)

generateConfig("../include/common/Config.h.auto")
